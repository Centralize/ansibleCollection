---
- name: Deploy and configure Zabbix
  hosts: zabbix_server
  become: true
  tasks:
    - name: Update cache and upgrade all packages.
      ansible.builtin.apt:
        name: "*"
        update_cache: yes
        state: latest
    - name: Download .deb package
      ansible.builtin.get_url:
        url: "https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_7.0-2+ubuntu22.04_all.deb"
        dest: "~/zabbix-release_7.0-2+ubuntu22.04_all.deb"
    - name: Install repo package
      ansible.builtin.shell: "dpkg -i ~/zabbix-release_7.0-2+ubuntu22.04_all.deb"
    - name: Update cache
      ansible.builtin.apt:
        name: "*"
        update_cache: yes
        state: latest
    - name: Install Zabbix packages.
      ansible.builtin.apt:
        pkg:
          - net-tools
          - mc
          - vim
          - mysql-server
          - mysql-client
          - apache2
          - php8.1
          - php8.1-common
          - zabbix-server-mysql
          - zabbix-frontend-php
          - zabbix-apache-conf
          - zabbix-sql-scripts
          - zabbix-agent
